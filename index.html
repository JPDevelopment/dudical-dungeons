<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>DUDICAL DUNGEONS</title>
    <meta name="description" content="DUDICAL DUNGEONS">
    <script src="https://aframe.io/releases/0.5.0/aframe.min.js"></script>
		<script src="https://rawgit.com/ryanbetts/aframe-daydream-controller-component/master/dist/aframe-daydream-controller-component.min.js"></script>
		<script src="https://cdn.rawgit.com/donmccurdy/aframe-extras/v2.6.1/dist/aframe-extras.js"></script>
		<script src="grid.js"></script>
  </head>
  <body>
    <a-scene>
			<!-- Asset Management System -->
			<a-assets>
				<img id="floor-texture" src="../assets/floor.jpg">
				<img id="wall-texture" src="../assets/wall.jpg">
				<audio id="music" src="../assets/music.mp3" preload="auto" loop="true"></audio>
				<video id="sky" autoplay loop="true" src="../assets/sky.mp4">
			</a-assets>
			<!-- Player/Camera Entity -->
			<a-entity id="player"
				camera
				universal-controls="movementControls: touch, gamepad, keyboard"
				kinematic-body
				position="0 2 0"
				sound="src: #music; autoplay: true" loop="true" >
				<a-light color="#fff" distance="15" intensity="4" type="spot"></a-light>
			</a-entity>
			<!-- Google Daydream Remote Configuration -->
			<a-entity id="remote" daydream-controller raycaster="objects: .selectable">
				<a-cone id="ray" color="green" position="0 0 -2" rotation="-90 0 0" radius-bottom="0.005" radius-top="0.001" height="4"></a-cone>
        <a-box id="position-guide" visible="false" position="0 0 -2"></a-box>
			</a-entity>
			<a-entity id="walls" static-body></a-entity>
			<a-videosphere src="#sky"></a-videosphere>
			<a-plane rotation="-90 0 0" width="100" height="100" src="#floor-texture" repeat="8 8" static-body></a-plane>
			<a-light type="ambient" intensity="3" color="800080"></a-light>
    </a-scene>
		<script>
			document.querySelector('a-scene').addEventListener('render-target-loaded', () => {
				var wallSize = 5,
						wallHeight = 8,
						wall,
						element = document.querySelector('#walls')

				for (let x = 0; x < grid.height; x++) {
					for (let y = 0; y < grid.width; y++) {
						const i = y * grid.width + x
						const position = (x - grid.width / 2) * wallSize + ' ' + 1.5 + ' ' + (y - grid.height / 2) * wallSize
							if (grid.data[i] === 1) {
								wall = document.createElement('a-box')
								element.appendChild(wall)
								wall.setAttribute('material', 'src: #wall-texture;')
								wall.setAttribute('width', wallSize)
								wall.setAttribute('height', wallHeight)
								wall.setAttribute('depth', wallSize)
								wall.setAttribute('position', position)
								wall.setAttribute('static-body', '')
								wall.setAttribute('metalness', 1)
								}
							if (grid.data[i] === 2) {
								document.querySelector('#player').setAttribute('position', position);
								}
							}
						}
				 })
		</script>
  </body>
</html>
